<div class="modal fade" id="appleWizardModal" tabindex="-1" aria-labelledby="appleWizardLabel" aria-hidden="true"
     data-controller="apple-wizard">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="appleWizardLabel">Set Up Apple Calendar</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%# Step 1 %>
        <div data-apple-wizard-target="step" data-step="1">
          <div class="text-center mb-3">
            <span style="font-size: 2rem;">1 / 3</span>
          </div>
          <h6>Open your Calendar app</h6>
          <p class="text-muted">
            On your <strong>Mac</strong>, open the Calendar app.<br>
            Or go to <a href="https://www.icloud.com/calendar" target="_blank" rel="noopener">icloud.com/calendar</a> in your browser.
          </p>
        </div>

        <%# Step 2 %>
        <div data-apple-wizard-target="step" data-step="2" class="d-none">
          <div class="text-center mb-3">
            <span style="font-size: 2rem;">2 / 3</span>
          </div>
          <h6>Share your calendar</h6>
          <p class="text-muted">
            In the Calendar app sidebar, <strong>right-click</strong> the calendar you want to share.<br>
            Select <strong>"Share Calendar..."</strong><br>
            Check <strong>"Public Calendar"</strong><br>
            Click <strong>"Copy Link"</strong> to copy the URL to your clipboard.
          </p>
          <div class="alert alert-light small">
            The link should look like: <code>webcal://p##-caldav.icloud.com/published/...</code>
          </div>
        </div>

        <%# Step 3 %>
        <div data-apple-wizard-target="step" data-step="3" class="d-none">
          <div class="text-center mb-3">
            <span style="font-size: 2rem;">3 / 3</span>
          </div>
          <h6>Paste your calendar link</h6>
          <%= form_with url: calendar_connections_path, method: :post, local: true, data: { apple_wizard_target: "form" } do |f| %>
            <%= f.hidden_field :source, value: "apple" %>
            <div class="mb-3">
              <label class="form-label">Calendar Name</label>
              <input type="text" name="name" class="form-control" placeholder="e.g., Work Calendar">
            </div>
            <div class="mb-3">
              <label class="form-label">iCal URL</label>
              <input type="url" name="import_url" class="form-control"
                     placeholder="webcal://p##-caldav.icloud.com/published/..."
                     required
                     data-apple-wizard-target="urlInput"
                     data-action="input->apple-wizard#validateUrl">
              <div class="invalid-feedback" data-apple-wizard-target="urlError">
                Please enter a valid iCal URL (webcal:// or https://)
              </div>
            </div>
            <%= f.submit "Connect Apple Calendar", class: "btn btn-primary w-100", data: { apple_wizard_target: "submitBtn" } %>
          <% end %>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary"
                data-apple-wizard-target="prevBtn"
                data-action="click->apple-wizard#prev"
                disabled>
          Previous
        </button>
        <button type="button" class="btn btn-primary"
                data-apple-wizard-target="nextBtn"
                data-action="click->apple-wizard#next">
          Next
        </button>
      </div>
    </div>
  </div>
</div>
