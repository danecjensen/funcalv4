<%# Feedback panel component - Luxurious golden-hour feedback experience %>
<%# Usage: render "feedback/panel" %>

<div data-controller="feedback"
     data-feedback-api-url-value="<%= feedbacks_path %>"
     data-feedback-open-value="false"
     class="chat-wrapper">

  <%# Floating orb toggle - glowing beacon %>
  <button type="button"
          class="chat-toggle-btn"
          data-action="click->feedback#toggle"
          aria-label="Toggle feedback form">
    <span class="chat-toggle-glow"></span>
    <span class="chat-toggle-orb">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
      </svg>
    </span>
    <span class="chat-toggle-ripple"></span>
  </button>

  <%# Feedback panel - organic flowing design %>
  <div class="chat-panel hidden" data-feedback-target="panel">
    <%# Decorative background layers %>
    <div class="chat-panel-bg">
      <div class="chat-panel-grain"></div>
      <div class="chat-panel-gradient"></div>
    </div>

    <%# Header with curved organic shape %>
    <div class="chat-header">
      <div class="chat-header-curve"></div>
      <div class="chat-header-content">
        <div class="chat-header-identity">
          <div class="chat-avatar-ring">
            <div class="chat-avatar">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
              </svg>
            </div>
          </div>
          <div class="chat-header-text">
            <h3>Feedback</h3>
            <p class="chat-header-subtitle">Help us improve</p>
          </div>
        </div>
        <div class="chat-header-actions">
          <button type="button"
                  class="chat-action-btn chat-action-close"
                  data-action="click->feedback#close"
                  title="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <%# Messages area with organic flow %>
    <div class="chat-messages" data-feedback-target="messages">
      <div class="chat-message chat-message-assistant">
        <div class="chat-message-avatar">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
          </svg>
        </div>
        <div class="chat-message-bubble">
          <p class="chat-greeting">We'd love to hear from you!</p>
          <div class="chat-capabilities">
            <div class="chat-capability">
              <span class="chat-capability-icon">✦</span>
              <span>Report bugs or issues</span>
            </div>
            <div class="chat-capability">
              <span class="chat-capability-icon">✦</span>
              <span>Suggest new features</span>
            </div>
            <div class="chat-capability">
              <span class="chat-capability-icon">✦</span>
              <span>Share your thoughts</span>
            </div>
          </div>
          <p class="chat-prompt">Your feedback about this page helps us improve.</p>
        </div>
      </div>

      <%# Success message (hidden by default) %>
      <div class="chat-message chat-message-assistant hidden" data-feedback-target="successMessage">
        <div class="chat-message-avatar">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
        </div>
        <div class="chat-message-bubble">
          <p><strong>Thank you!</strong> Your feedback has been received. We'll review it and use it to make improvements.</p>
        </div>
      </div>
    </div>

    <%# Input area with elegant styling %>
    <form class="chat-form" data-feedback-target="form" data-action="submit->feedback#submit">
      <div class="chat-input-wrapper">
        <textarea
          data-feedback-target="input"
          data-action="keydown->feedback#handleKeydown"
          placeholder="Share your feedback about this page..."
          rows="3"
          class="chat-input"
          autocomplete="off"
          required></textarea>
      </div>
      <button type="submit"
              class="chat-send-btn"
              data-feedback-target="sendButton"
              aria-label="Send feedback"
              style="width: 100%; height: 48px; border-radius: 14px; margin-top: 12px;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 2L11 13"></path>
          <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
        </svg>
        <span style="margin-left: 8px;">Send Feedback</span>
      </button>
      <p class="chat-input-hint">Press <kbd>Ctrl</kbd>+<kbd>Enter</kbd> to send</p>
    </form>
  </div>
</div>
